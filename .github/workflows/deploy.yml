name: Deploy to All Machines

on:
  push:
    branches: [main]

jobs:
  sync:
    name: Sync ${{ matrix.name }}
    strategy:
      matrix:
        include:
          - name: DGX Spark
            runner: "[self-hosted, dgx, arm64]"
            path: /home/nmyers/Projects/BCOM-C

          - name: M4 Pro
            runner: "[self-hosted, m4pro, arm64]"
            path: /Users/myro-pro/Projects/BCOM-C

          - name: Linux Desktop
            runner: "[self-hosted, linux-desktop, x64]"
            path: /home/myroproductions/Projects/BCOM-C

    runs-on: ${{ fromJSON(matrix.runner) }}
    steps:
      - name: Pull latest
        run: git -C ${{ matrix.path }} pull origin main

      - name: Confirm
        run: |
          echo "${{ matrix.name }} updated at $(date)"
          git -C ${{ matrix.path }} log --oneline -2
