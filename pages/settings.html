<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BCOM-C ‚Äî Settings</title>
<link rel="stylesheet" href="../assets/css/bcom.css?v=4" />
<script>
  /* Apply theme before render to avoid flash */
  (function(){
    var t=localStorage.getItem('bcom-theme')||'dark';
    document.documentElement.setAttribute('data-theme',t);
    /* Restore saved theme vars immediately to avoid flash */
    try {
      var raw=localStorage.getItem('bcom-theme-vars');
      if(raw){ var vars=JSON.parse(raw); Object.keys(vars).forEach(function(k){ document.documentElement.style.setProperty(k,vars[k]); }); }
    } catch(_) {}
  })();
</script>
<style>
/* ‚îÄ‚îÄ THEME EDITOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.theme-picker-row { padding: 5px 12px; }
.theme-picker-wrap { display:flex; align-items:center; gap:8px; }
.theme-picker {
  width:32px; height:24px; padding:1px;
  border:1.5px solid var(--border-dim); background:transparent;
  cursor:pointer; border-radius:2px;
}
.theme-hex { font-size:11px; color:var(--text-muted); letter-spacing:1px; min-width:64px; }
.saved-theme-row {
  display:flex; align-items:center; gap:6px;
  padding:5px 8px; border:1px solid var(--border-dim);
  border-radius:2px; background:rgba(255,255,255,0.03);
}
.saved-theme-name { flex:1; font-size:11px; letter-spacing:1px; color:var(--text); }
.saved-theme-dot-row { display:flex; gap:3px; margin-right:6px; }
.saved-theme-dot { width:10px; height:10px; border-radius:50%; border:1px solid rgba(255,255,255,0.15); }
.saved-theme-btn {
  font-family:'Courier New',monospace; font-size:9px; letter-spacing:1px;
  padding:2px 8px; cursor:pointer; text-transform:uppercase;
  border:1px solid var(--border-dim); background:transparent;
  color:var(--text-muted);
}
.saved-theme-btn:hover { color:var(--orange); border-color:var(--orange-dark); }
.saved-theme-btn.del { color:#e74c3c; border-color:#e74c3c; }
.saved-theme-btn.del:hover { background:#e74c3c22; }
#theme-name-modal { display:none; }
#theme-name-modal.open { display:flex; }
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="topbar-title">BCOM-C</div>
  <div class="topbar-right">
    <a class="nav-btn" href="../index.html"><span class="nav-arrow">&#8592;</span> DASHBOARD</a>
    <a class="nav-btn" href="data-gen.html">DATA GEN</a>
    <a class="nav-btn" href="pipeline.html">PIPELINE</a>
    <a class="nav-btn" href="resources.html">RESOURCES</a>
    <a class="nav-btn" href="reports.html">REPORTS</a>
    <a class="nav-btn" href="orchestrator.html">ORCHESTRATOR</a>
    <a class="cog-btn active" href="settings.html" title="Settings">‚öô</a>
    <div class="timestamp"><span id="clock">--:--:--</span>&nbsp;&nbsp;<span id="datestamp">----/--/--</span></div>
  </div>
</div>

<!-- ACTION BAR -->
<div class="actionbar">
  <span style="font-size:11px;letter-spacing:2px;color:var(--orange);font-weight:700;">BCOM-C SETTINGS</span>
  <span style="font-size:10px;letter-spacing:1px;color:var(--text-muted);margin-left:8px;">Configure dashboard, nodes, inference, and orchestration</span>
</div>

<!-- SETTINGS LAYOUT -->
<div class="sett-layout">

  <!-- ‚îÄ‚îÄ API & CONNECTIVITY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="sett-section">
    <div class="sett-hdr"><span class="sett-hdr-icon">üîå</span> API &amp; Connectivity</div>

    <div class="sett-row">
      <label>FastAPI Base URL</label>
      <input class="sett-input wide" id="api-base-url" type="text" value="" placeholder="https://bcom.myroproductions.com" />
    </div>

    <div class="sett-row">
      <label>API Key</label>
      <input class="sett-input wide" id="api-key" type="password" placeholder="leave empty if none" />
    </div>

    <div class="sett-row">
      <label>Dashboard Poll Rate</label>
      <div style="display:flex;align-items:center;gap:6px;">
        <input class="sett-input narrow" id="poll-rate" type="number" min="2" max="60" value="5" />
        <span style="font-size:11px;color:var(--text-muted);">SEC</span>
      </div>
    </div>

    <div class="sett-row">
      <label>Metrics Poll Rate</label>
      <div style="display:flex;align-items:center;gap:6px;">
        <input class="sett-input narrow" id="metrics-poll" type="number" min="5" max="60" value="10" />
        <span style="font-size:11px;color:var(--text-muted);">SEC</span>
      </div>
    </div>

    <div class="sett-row">
      <label>Request Timeout</label>
      <div style="display:flex;align-items:center;gap:6px;">
        <input class="sett-input narrow" id="req-timeout" type="number" min="1" max="30" value="8" />
        <span style="font-size:11px;color:var(--text-muted);">SEC</span>
      </div>
    </div>

    <div class="sett-row">
      <label>Connection Status</label>
      <div style="display:flex;align-items:center;gap:8px;">
        <div id="conn-dot" style="width:8px;height:8px;border-radius:50%;background:#555;"></div>
        <span id="conn-label" style="font-size:11px;letter-spacing:1px;color:var(--text-muted);">UNKNOWN</span>
        <button class="sett-btn" onclick="testConnection()" style="padding:3px 10px;font-size:10px;">TEST</button>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ NODE CONFIGURATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="sett-section">
    <div class="sett-hdr"><span class="sett-hdr-icon">üñ•</span> Node Configuration</div>

    <div class="sett-row" style="background:rgba(218,119,86,0.04);">
      <label style="color:var(--orange);font-weight:700;">SPARK-BOB (DGX GB10)</label>
      <span style="font-size:10px;color:var(--text-muted);">Primary inference node</span>
    </div>

    <div class="sett-row">
      <label>Spark Host</label>
      <input class="sett-input" id="spark-host" type="text" value="10.0.0.69" />
    </div>

    <div class="sett-row">
      <label>Spark FastAPI Port</label>
      <input class="sett-input narrow" id="spark-port" type="number" value="9010" />
    </div>

    <div class="sett-row">
      <label>node_exporter Port</label>
      <input class="sett-input narrow" id="spark-ne-port" type="number" value="9100" />
    </div>

    <div class="sett-row" style="background:rgba(218,119,86,0.04);margin-top:4px;">
      <label style="color:var(--orange);font-weight:700;">LINUX-DSKTP</label>
      <span style="font-size:10px;color:var(--text-muted);">UBNTxWINDesktop</span>
    </div>

    <div class="sett-row">
      <label>Linux Host</label>
      <input class="sett-input" id="linux-host" type="text" value="10.0.0.10" />
    </div>

    <div class="sett-row">
      <label>node_exporter Port</label>
      <input class="sett-input narrow" id="linux-ne-port" type="number" value="9100" />
    </div>

    <div class="sett-row">
      <label>Linux Node User</label>
      <input class="sett-input" id="linux-user" type="text" value="myroproductions" />
    </div>

    <div class="sett-row" style="background:rgba(218,119,86,0.04);margin-top:4px;">
      <label style="color:var(--orange);font-weight:700;">MAC MINI</label>
      <span style="font-size:10px;color:var(--text-muted);">Caddy / hosting node</span>
    </div>

    <div class="sett-row">
      <label>Mac Mini Host</label>
      <input class="sett-input" id="mini-host" type="text" value="10.0.0.223" />
    </div>
  </div>

  <!-- ‚îÄ‚îÄ METRIC THRESHOLDS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="sett-section">
    <div class="sett-hdr"><span class="sett-hdr-icon">üå°</span> Metric Thresholds &amp; Alerts</div>

    <div class="sett-row" style="background:rgba(218,119,86,0.04);">
      <label style="color:var(--text-dim);">CPU Temperature</label>
      <span style="font-size:10px;color:var(--text-muted);">warn / critical ¬∞C</span>
    </div>
    <div class="sett-row">
      <label>CPU Warn Threshold</label>
      <div style="display:flex;align-items:center;gap:6px;">
        <input class="sett-input narrow" id="cpu-warn-temp" type="number" value="70" />
        <span style="font-size:11px;color:var(--text-muted);">¬∞C</span>
      </div>
    </div>
    <div class="sett-row">
      <label>CPU Critical Threshold</label>
      <div style="display:flex;align-items:center;gap:6px;">
        <input class="sett-input narrow" id="cpu-crit-temp" type="number" value="85" />
        <span style="font-size:11px;color:var(--text-muted);">¬∞C</span>
      </div>
    </div>

    <div class="sett-row" style="background:rgba(218,119,86,0.04);margin-top:4px;">
      <label style="color:var(--text-dim);">GPU Temperature</label>
      <span style="font-size:10px;color:var(--text-muted);">warn / critical ¬∞C</span>
    </div>
    <div class="sett-row">
      <label>GPU Warn Threshold</label>
      <div style="display:flex;align-items:center;gap:6px;">
        <input class="sett-input narrow" id="gpu-warn-temp" type="number" value="75" />
        <span style="font-size:11px;color:var(--text-muted);">¬∞C</span>
      </div>
    </div>
    <div class="sett-row">
      <label>GPU Critical Threshold</label>
      <div style="display:flex;align-items:center;gap:6px;">
        <input class="sett-input narrow" id="gpu-crit-temp" type="number" value="90" />
        <span style="font-size:11px;color:var(--text-muted);">¬∞C</span>
      </div>
    </div>

    <div class="sett-row" style="background:rgba(218,119,86,0.04);margin-top:4px;">
      <label style="color:var(--text-dim);">Memory</label>
      <span style="font-size:10px;color:var(--text-muted);">% thresholds</span>
    </div>
    <div class="sett-row">
      <label>RAM Warn %</label>
      <input class="sett-input narrow" id="ram-warn-pct" type="number" value="85" />
    </div>
    <div class="sett-row">
      <label>VRAM Warn %</label>
      <input class="sett-input narrow" id="vram-warn-pct" type="number" value="90" />
    </div>

    <div class="sett-row" style="background:rgba(218,119,86,0.04);margin-top:4px;">
      <label style="color:var(--text-dim);">Node Offline Alert</label>
    </div>
    <div class="sett-row">
      <label>Alert on Node Offline</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-offline-alert" checked />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-offline-alert">ON</span>
      </label>
    </div>
    <div class="sett-row">
      <label>Browser Notification</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-browser-notif" />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-browser-notif">OFF</span>
      </label>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ DASHBOARD PANELS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="sett-section">
    <div class="sett-hdr"><span class="sett-hdr-icon">üìä</span> Dashboard Panels</div>

    <div class="sett-row">
      <label>Show Spark Node</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-show-spark" checked />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-show-spark">ON</span>
      </label>
    </div>
    <div class="sett-row">
      <label>Show Linux Node</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-show-linux" checked />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-show-linux">ON</span>
      </label>
    </div>
    <div class="sett-row">
      <label>Show Containers</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-show-containers" checked />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-show-containers">ON</span>
      </label>
    </div>
    <div class="sett-row">
      <label>Show Models</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-show-models" checked />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-show-models">ON</span>
      </label>
    </div>
    <div class="sett-row">
      <label>Show Evaluations</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-show-evals" checked />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-show-evals">ON</span>
      </label>
    </div>
    <div class="sett-row">
      <label>Show MCP Servers</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-show-mcp" checked />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-show-mcp">ON</span>
      </label>
    </div>
    <div class="sett-row">
      <label>Auto-Scroll Logs</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-autoscroll" checked />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-autoscroll">ON</span>
      </label>
    </div>
    <div class="sett-row">
      <label>Max Log Lines</label>
      <input class="sett-input narrow" id="max-log-lines" type="number" min="20" max="500" value="100" />
    </div>
  </div>

  <!-- ‚îÄ‚îÄ INFERENCE & MODEL SETTINGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="sett-section">
    <div class="sett-hdr"><span class="sett-hdr-icon">ü§ñ</span> Inference &amp; Model Settings</div>

    <div class="sett-row">
      <label>Default Backend</label>
      <select class="sett-select" id="default-backend">
        <option value="vllm">vLLM</option>
        <option value="ollama">Ollama</option>
        <option value="tgi">TGI</option>
        <option value="openai">OpenAI-compat</option>
      </select>
    </div>

    <div class="sett-row">
      <label>Default Model</label>
      <input class="sett-input wide" id="default-model" type="text" placeholder="e.g. meta-llama/Llama-3-8B-Instruct" />
    </div>

    <div class="sett-row">
      <label>Inference Endpoint</label>
      <input class="sett-input wide" id="infer-endpoint" type="text" placeholder="http://spark:9010/v1" />
    </div>

    <div class="sett-row">
      <label>Context Window (tokens)</label>
      <input class="sett-input narrow" id="context-len" type="number" value="4096" />
    </div>

    <div class="sett-row">
      <label>Max Output Tokens</label>
      <input class="sett-input narrow" id="max-tokens" type="number" value="1024" />
    </div>

    <div class="sett-row">
      <label>Default Temperature</label>
      <input class="sett-input narrow" id="temperature" type="number" min="0" max="2" step="0.05" value="0.7" />
    </div>

    <div class="sett-row">
      <label>Top-P</label>
      <input class="sett-input narrow" id="top-p" type="number" min="0" max="1" step="0.01" value="0.9" />
    </div>

    <div class="sett-row">
      <label>Stream Responses</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-stream" checked />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-stream">ON</span>
      </label>
    </div>

    <div class="sett-row">
      <label>Auto-Load Model on Start</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-autoload" />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-autoload">OFF</span>
      </label>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ ORCHESTRATION SETTINGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="sett-section">
    <div class="sett-hdr"><span class="sett-hdr-icon">üï∏</span> Orchestration Settings</div>

    <div class="sett-row">
      <label>Orchestrator Mode</label>
      <select class="sett-select" id="orch-mode">
        <option value="langchain">LangChain Multi-Agent</option>
        <option value="manual">Manual Dispatch</option>
        <option value="crewai">CrewAI</option>
        <option value="autogen">AutoGen</option>
      </select>
    </div>

    <div class="sett-row">
      <label>Router Strategy</label>
      <select class="sett-select" id="router-strategy">
        <option value="llm">LLM-Based</option>
        <option value="keyword">Keyword</option>
        <option value="roundrobin">Round-Robin</option>
      </select>
    </div>

    <div class="sett-row">
      <label>Agent Timeout</label>
      <div style="display:flex;align-items:center;gap:6px;">
        <input class="sett-input narrow" id="agent-timeout" type="number" value="120" />
        <span style="font-size:11px;color:var(--text-muted);">SEC</span>
      </div>
    </div>

    <div class="sett-row">
      <label>Max Parallel Agents</label>
      <input class="sett-input narrow" id="max-agents" type="number" min="1" max="16" value="4" />
    </div>

    <div class="sett-row">
      <label>Task Queue Limit</label>
      <input class="sett-input narrow" id="task-queue-limit" type="number" min="1" max="100" value="20" />
    </div>

    <div class="sett-row">
      <label>Auto-Dispatch Tasks</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-auto-dispatch" />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-auto-dispatch">OFF</span>
      </label>
    </div>

    <div class="sett-row">
      <label>LangChain Tracing</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-lc-trace" />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-lc-trace">OFF</span>
      </label>
    </div>

    <div class="sett-row">
      <label>Memory Backend</label>
      <select class="sett-select" id="memory-backend">
        <option value="buffer">In-Memory Buffer</option>
        <option value="vector">Vector Store</option>
        <option value="redis">Redis</option>
        <option value="postgres">PostgreSQL</option>
      </select>
    </div>

    <div class="sett-row">
      <label>Retry on Failure</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-retry" checked />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-retry">ON</span>
      </label>
    </div>

    <div class="sett-row">
      <label>Max Retries</label>
      <input class="sett-input narrow" id="max-retries" type="number" min="0" max="10" value="3" />
    </div>
  </div>

  <!-- ‚îÄ‚îÄ PIPELINE & DATAGEN SETTINGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="sett-section">
    <div class="sett-hdr"><span class="sett-hdr-icon">‚öó</span> Pipeline &amp; Data Gen</div>

    <div class="sett-row">
      <label>Default Pipeline</label>
      <select class="sett-select" id="default-pipeline">
        <option value="irs990">IRS 990 ETL</option>
        <option value="custom">Custom</option>
      </select>
    </div>

    <div class="sett-row">
      <label>Output Format</label>
      <select class="sett-select" id="output-format">
        <option value="json">JSON</option>
        <option value="csv">CSV</option>
        <option value="parquet">Parquet</option>
        <option value="jsonl">JSONL</option>
      </select>
    </div>

    <div class="sett-row">
      <label>Data Output Path</label>
      <input class="sett-input wide" id="data-output-path" type="text" placeholder="/data/output" />
    </div>

    <div class="sett-row">
      <label>Batch Size</label>
      <input class="sett-input narrow" id="batch-size" type="number" value="32" />
    </div>

    <div class="sett-row">
      <label>Parallel Workers</label>
      <input class="sett-input narrow" id="parallel-workers" type="number" min="1" max="32" value="4" />
    </div>

    <div class="sett-row">
      <label>Auto-Retry Failed Jobs</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-job-retry" checked />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-job-retry">ON</span>
      </label>
    </div>

    <div class="sett-row">
      <label>Save Intermediate Steps</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-save-steps" />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-save-steps">OFF</span>
      </label>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ MAINTENANCE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="sett-section">
    <div class="sett-hdr"><span class="sett-hdr-icon">üîß</span> Maintenance</div>

    <div class="sett-row">
      <label>Clear Action Log</label>
      <button class="sett-btn" onclick="maintAction('clear-log')">CLEAR LOG</button>
    </div>

    <div class="sett-row">
      <label>Clear Terminal History</label>
      <button class="sett-btn" onclick="maintAction('clear-term')">CLEAR TERMINAL</button>
    </div>

    <div class="sett-row">
      <label>Export Settings</label>
      <button class="sett-btn success" onclick="exportSettings()">EXPORT JSON</button>
    </div>

    <div class="sett-row">
      <label>Import Settings</label>
      <div style="display:flex;gap:6px;align-items:center;">
        <input type="file" id="import-file" accept=".json" style="display:none;" onchange="importSettings(event)" />
        <button class="sett-btn" onclick="document.getElementById('import-file').click()">IMPORT JSON</button>
      </div>
    </div>

    <div class="sett-row">
      <label>Restart FastAPI Service</label>
      <button class="sett-btn danger" onclick="confirmAction('RESTART FASTAPI', '/api/system/restart')">RESTART API</button>
    </div>

    <div class="sett-row">
      <label>Restart vLLM</label>
      <button class="sett-btn danger" onclick="triggerAction('RESTART VLLM')">RESTART VLLM</button>
    </div>

    <div class="sett-row">
      <label>Restart LLM Backend</label>
      <button class="sett-btn danger" onclick="triggerAction('RESTART LLM')">RESTART LLM</button>
    </div>

    <div class="sett-row">
      <label style="color:#e05030;font-weight:700;">Reset All Settings</label>
      <button class="sett-btn danger" onclick="resetAllSettings()">‚ö† FACTORY RESET</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ ABOUT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="sett-section">
    <div class="sett-hdr"><span class="sett-hdr-icon">‚Ñπ</span> About</div>

    <div class="sett-about-grid">
      <div class="sett-row" style="border-right:1px solid var(--border-dim);">
        <label>Version</label>
        <span style="font-size:12px;color:var(--orange);letter-spacing:1px;">BCOM-C v0.1</span>
      </div>
      <div class="sett-row">
        <label>Build Date</label>
        <span style="font-size:12px;color:var(--text-dim);" id="about-build-date">2026-02-28</span>
      </div>
      <div class="sett-row" style="border-right:1px solid var(--border-dim);">
        <label>API Host</label>
        <span style="font-size:12px;color:var(--text-dim);">spark:9010</span>
      </div>
      <div class="sett-row">
        <label>Dashboard URL</label>
        <span style="font-size:11px;color:var(--text-muted);">bcom.myroproductions.com</span>
      </div>
      <div class="sett-row" style="border-right:1px solid var(--border-dim);">
        <label>Inference Node</label>
        <span style="font-size:12px;color:var(--text-dim);">DGX Spark GB10</span>
      </div>
      <div class="sett-row">
        <label>Hosting Node</label>
        <span style="font-size:12px;color:var(--text-dim);">Mac Mini M4</span>
      </div>
      <div class="sett-row" style="border-right:1px solid var(--border-dim);">
        <label>Metrics Node</label>
        <span style="font-size:12px;color:var(--text-dim);">UBNTxWINDesktop</span>
      </div>
      <div class="sett-row">
        <label>Caddy + Cloudflare</label>
        <span style="font-size:12px;color:#2ecc71;">ACTIVE</span>
      </div>
    </div>

    <div class="sett-row" style="flex-direction:column;align-items:flex-start;gap:4px;">
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <a href="https://github.com/Myro-Productions-ORG/BCOM-C" target="_blank"
           style="font-size:10px;color:var(--orange);letter-spacing:1px;text-decoration:none;">
          ‚Üó GITHUB REPO
        </a>
        <span style="font-size:10px;color:var(--border-dim);">|</span>
        <a href="https://bcom.myroproductions.com" target="_blank"
           style="font-size:10px;color:var(--orange);letter-spacing:1px;text-decoration:none;">
          ‚Üó LIVE DASHBOARD
        </a>
        <span style="font-size:10px;color:var(--border-dim);">|</span>
        <a href="../index.html"
           style="font-size:10px;color:var(--orange);letter-spacing:1px;text-decoration:none;">
          ‚Üê BACK TO DASHBOARD
        </a>
      </div>
    </div>
  </div>


  <!-- ‚îÄ‚îÄ THEME EDITOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="sett-section" id="theme-editor-section">
    <div class="sett-hdr"><span class="sett-hdr-icon">üé®</span> Theme Editor</div>

    <!-- ‚îÄ‚îÄ Appearance (consolidated from top card) ‚îÄ‚îÄ -->
    <div class="sett-row" style="background:rgba(218,119,86,0.04);">
      <label style="color:var(--text-dim);font-weight:700;letter-spacing:1px;">APPEARANCE</label>
    </div>

    <div class="sett-row">
      <label>Theme</label>
      <div class="theme-btn-group">
        <button class="theme-btn" id="btn-dark"  onclick="applyTheme('dark')">‚óº DARK</button>
        <button class="theme-btn" id="btn-light" onclick="applyTheme('light')">‚óª LIGHT</button>
      </div>
    </div>

    <div class="sett-row">
      <label>Accent Color</label>
      <div style="display:flex;align-items:center;gap:8px;">
        <input type="color" id="accent-color" value="#DA7756"
               style="width:32px;height:24px;border:1.5px solid var(--orange-dark);background:transparent;cursor:pointer;padding:1px;"
               oninput="previewAccent(this.value)" />
        <span style="font-size:11px;color:var(--text-muted);letter-spacing:1px;" id="accent-hex">#DA7756</span>
        <button class="sett-btn" onclick="resetAccent()" style="padding:3px 10px;font-size:10px;">RESET</button>
      </div>
    </div>

    <div class="sett-row">
      <label>Clock Format</label>
      <select class="sett-select" id="clock-format" style="width:120px;">
        <option value="24h">24-HOUR</option>
        <option value="12h">12-HOUR</option>
      </select>
    </div>

    <div class="sett-row">
      <label>Compact Density</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-compact" />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-compact">OFF</span>
      </label>
    </div>

    <div class="sett-row">
      <label>Animate Gauges</label>
      <label class="sett-toggle">
        <input type="checkbox" id="tog-animate" checked />
        <span class="sett-toggle-track"></span>
        <span class="sett-toggle-label" id="lbl-animate">ON</span>
      </label>
    </div>

    <!-- Color layers -->
    <div class="sett-row" style="background:rgba(218,119,86,0.04);margin-top:4px;">
      <label style="color:var(--text-dim);font-weight:700;letter-spacing:1px;">BACKGROUNDS</label>
    </div>

    <div class="sett-row theme-picker-row">
      <label>Body</label>
      <div class="theme-picker-wrap">
        <input type="color" class="theme-picker" id="tc--bg" value="#3b3b3b" oninput="themePreview('--bg',this.value)" />
        <span class="theme-hex" id="th--bg">#3b3b3b</span>
      </div>
    </div>
    <div class="sett-row theme-picker-row">
      <label>Panels</label>
      <div class="theme-picker-wrap">
        <input type="color" class="theme-picker" id="tc--bg-panel" value="#3b3b3b" oninput="themePreview('--bg-panel',this.value)" />
        <span class="theme-hex" id="th--bg-panel">#3b3b3b</span>
      </div>
    </div>
    <div class="sett-row theme-picker-row">
      <label>Nav / Bar</label>
      <div class="theme-picker-wrap">
        <input type="color" class="theme-picker" id="tc--bg-bar" value="#3b3b3b" oninput="themePreview('--bg-bar',this.value)" />
        <span class="theme-hex" id="th--bg-bar">#3b3b3b</span>
      </div>
    </div>
    <div class="sett-row theme-picker-row">
      <label>Deep / Headers</label>
      <div class="theme-picker-wrap">
        <input type="color" class="theme-picker" id="tc--bg-deep" value="#3b3b3b" oninput="themePreview('--bg-deep',this.value)" />
        <span class="theme-hex" id="th--bg-deep">#3b3b3b</span>
      </div>
    </div>
    <div class="sett-row theme-picker-row">
      <label>Input BG</label>
      <div class="theme-picker-wrap">
        <input type="color" class="theme-picker" id="tc--input-bg" value="#2e2e2e" oninput="themePreview('--input-bg',this.value)" />
        <span class="theme-hex" id="th--input-bg">#2e2e2e</span>
      </div>
    </div>

    <div class="sett-row" style="background:rgba(218,119,86,0.04);margin-top:4px;">
      <label style="color:var(--text-dim);font-weight:700;letter-spacing:1px;">TEXT</label>
    </div>
    <div class="sett-row theme-picker-row">
      <label>Primary Text</label>
      <div class="theme-picker-wrap">
        <input type="color" class="theme-picker" id="tc--text" value="#ffffff" oninput="themePreview('--text',this.value)" />
        <span class="theme-hex" id="th--text">#ffffff</span>
      </div>
    </div>
    <div class="sett-row theme-picker-row">
      <label>Dim Text</label>
      <div class="theme-picker-wrap">
        <input type="color" class="theme-picker" id="tc--text-dim" value="#e0e0e0" oninput="themePreview('--text-dim',this.value)" />
        <span class="theme-hex" id="th--text-dim">#e0e0e0</span>
      </div>
    </div>
    <div class="sett-row theme-picker-row">
      <label>Muted Text</label>
      <div class="theme-picker-wrap">
        <input type="color" class="theme-picker" id="tc--text-muted" value="#aaaaaa" oninput="themePreview('--text-muted',this.value)" />
        <span class="theme-hex" id="th--text-muted">#aaaaaa</span>
      </div>
    </div>

    <div class="sett-row" style="background:rgba(218,119,86,0.04);margin-top:4px;">
      <label style="color:var(--text-dim);font-weight:700;letter-spacing:1px;">ACCENT</label>
    </div>
    <div class="sett-row theme-picker-row">
      <label>Accent</label>
      <div class="theme-picker-wrap">
        <input type="color" class="theme-picker" id="tc--orange" value="#DA7756" oninput="themePreview('--orange',this.value)" />
        <span class="theme-hex" id="th--orange">#DA7756</span>
      </div>
    </div>
    <div class="sett-row theme-picker-row">
      <label>Accent Dark</label>
      <div class="theme-picker-wrap">
        <input type="color" class="theme-picker" id="tc--orange-dark" value="#b8613a" oninput="themePreview('--orange-dark',this.value)" />
        <span class="theme-hex" id="th--orange-dark">#b8613a</span>
      </div>
    </div>
    <div class="sett-row theme-picker-row">
      <label>Accent Deep</label>
      <div class="theme-picker-wrap">
        <input type="color" class="theme-picker" id="tc--orange-deep" value="#6b3020" oninput="themePreview('--orange-deep',this.value)" />
        <span class="theme-hex" id="th--orange-deep">#6b3020</span>
      </div>
    </div>

    <div class="sett-row" style="background:rgba(218,119,86,0.04);margin-top:4px;">
      <label style="color:var(--text-dim);font-weight:700;letter-spacing:1px;">BORDERS</label>
    </div>
    <div class="sett-row theme-picker-row">
      <label>Border</label>
      <div class="theme-picker-wrap">
        <input type="color" class="theme-picker" id="tc--border" value="#b8613a" oninput="themePreview('--border',this.value)" />
        <span class="theme-hex" id="th--border">#b8613a</span>
      </div>
    </div>
    <div class="sett-row theme-picker-row">
      <label>Border Dim</label>
      <div class="theme-picker-wrap">
        <input type="color" class="theme-picker" id="tc--border-dim" value="#5a3a28" oninput="themePreview('--border-dim',this.value)" />
        <span class="theme-hex" id="th--border-dim">#5a3a28</span>
      </div>
    </div>

    <!-- Action row -->
    <div class="sett-row" style="gap:8px;flex-wrap:wrap;padding:10px 12px;">
      <button class="sett-btn" onclick="themeReset()" style="font-size:10px;">RESET TO DEFAULT</button>
      <button class="sett-btn" onclick="themeApply()" style="font-size:10px;color:var(--orange);border-color:var(--orange);">APPLY THEME</button>
      <button class="sett-btn success" onclick="themeSavePrompt()" style="font-size:10px;">SAVE THEME‚Ä¶</button>
    </div>

    <!-- Saved themes list -->
    <div class="sett-row" style="background:rgba(218,119,86,0.04);margin-top:4px;">
      <label style="color:var(--text-dim);font-weight:700;letter-spacing:1px;">SAVED THEMES</label>
      <button class="sett-btn" onclick="themeLoadList()" style="font-size:9px;padding:2px 8px;">REFRESH</button>
    </div>
    <div id="saved-themes-list" style="padding:6px 12px;display:flex;flex-direction:column;gap:4px;min-height:32px;">
      <span style="font-size:10px;color:var(--text-muted);letter-spacing:1px;">Loading‚Ä¶</span>
    </div>
  </div>

</div><!-- end .sett-layout -->

<!-- THEME NAME MODAL -->
<div id="theme-name-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:999;align-items:center;justify-content:center;">
  <div style="background:var(--bg-panel);border:1.5px solid var(--orange-dark);border-radius:3px;padding:22px 26px;min-width:280px;max-width:360px;font-family:'Courier New',monospace;">
    <div style="font-size:11px;font-weight:700;letter-spacing:2px;color:var(--orange);margin-bottom:14px;">SAVE THEME</div>
    <input id="theme-name-input" type="text" maxlength="48"
      placeholder="My Theme Name"
      style="width:100%;box-sizing:border-box;background:var(--input-bg);border:1px solid var(--border-dim);color:var(--text);font-family:'Courier New',monospace;font-size:12px;padding:7px 10px;letter-spacing:1px;outline:none;margin-bottom:12px;"
      onkeydown="if(event.key==='Enter')themeSaveConfirm(); if(event.key==='Escape')themeSaveCancel();" />
    <div style="display:flex;gap:8px;justify-content:flex-end;">
      <button class="sett-btn" onclick="themeSaveCancel()" style="font-size:10px;">CANCEL</button>
      <button class="sett-btn success" onclick="themeSaveConfirm()" style="font-size:10px;">SAVE</button>
    </div>
  </div>
</div>

<!-- SAVE BAR -->
<div class="sett-save-bar">
  <span class="sett-save-msg" id="save-msg">‚úì SETTINGS SAVED</span>
  <span id="unsaved-indicator" style="display:none;font-size:10px;letter-spacing:1px;color:var(--orange);">‚óè UNSAVED CHANGES</span>
  <button class="sett-btn" onclick="loadSettings()">REVERT</button>
  <button class="sett-btn success" onclick="saveSettings(true)">SAVE SETTINGS</button>
</div>

<!-- FOOTER -->
<div class="footer">
  <span>BOB-AI // BCOM-C v0.1 ‚Äî SETTINGS</span>
  <span id="footer-date"></span>
  <span>CONFIGURE &amp; MANAGE</span>
</div>

<script src="../assets/js/bcom.js?v=5"></script>
<script>

/* ‚îÄ‚îÄ Theme button state sync ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function syncThemeBtns() {
  const cur = document.documentElement.getAttribute('data-theme') || 'dark';
  document.getElementById('btn-dark').classList.toggle('active',  cur === 'dark');
  document.getElementById('btn-light').classList.toggle('active', cur === 'light');
}

function applyTheme(t) {
  setTheme(t);
  syncThemeBtns();
}

/* ‚îÄ‚îÄ Toggle label sync ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function syncToggleLabel(inputId, labelId) {
  const cb  = document.getElementById(inputId);
  const lbl = document.getElementById(labelId);
  if (cb && lbl) lbl.textContent = cb.checked ? 'ON' : 'OFF';
}

const TOGGLES = [
  ['tog-compact','lbl-compact'],
  ['tog-animate','lbl-animate'],
  ['tog-offline-alert','lbl-offline-alert'],
  ['tog-browser-notif','lbl-browser-notif'],
  ['tog-show-spark','lbl-show-spark'],
  ['tog-show-linux','lbl-show-linux'],
  ['tog-show-containers','lbl-show-containers'],
  ['tog-show-models','lbl-show-models'],
  ['tog-show-evals','lbl-show-evals'],
  ['tog-show-mcp','lbl-show-mcp'],
  ['tog-autoscroll','lbl-autoscroll'],
  ['tog-stream','lbl-stream'],
  ['tog-autoload','lbl-autoload'],
  ['tog-auto-dispatch','lbl-auto-dispatch'],
  ['tog-lc-trace','lbl-lc-trace'],
  ['tog-retry','lbl-retry'],
  ['tog-job-retry','lbl-job-retry'],
  ['tog-save-steps','lbl-save-steps'],
];

function syncAllLabels() { TOGGLES.forEach(([i,l]) => syncToggleLabel(i,l)); }

document.querySelectorAll('.sett-toggle input[type="checkbox"]').forEach(cb => {
  cb.addEventListener('change', function() {
    const lbl = this.id.replace('tog-','lbl-');
    syncToggleLabel(this.id, lbl);
  });
});

/* ‚îÄ‚îÄ Settings persistence ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const SETT_KEY   = 'bcom-settings';
const THEMES_KEY = 'bcom-saved-themes';

/* localStorage theme helpers */
function _getLocalThemes() {
  try { return JSON.parse(localStorage.getItem(THEMES_KEY) || '[]'); } catch(_) { return []; }
}
function _setLocalThemes(arr) {
  try { localStorage.setItem(THEMES_KEY, JSON.stringify(arr)); } catch(_) {}
}

const FIELDS = [
  'api-base-url','api-key','poll-rate','metrics-poll','req-timeout',
  'spark-host','spark-port','spark-ne-port','linux-host','linux-ne-port',
  'linux-user','mini-host',
  'cpu-warn-temp','cpu-crit-temp','gpu-warn-temp','gpu-crit-temp',
  'ram-warn-pct','vram-warn-pct','max-log-lines',
  'default-backend','default-model','infer-endpoint','context-len',
  'max-tokens','temperature','top-p',
  'orch-mode','router-strategy','agent-timeout','max-agents',
  'task-queue-limit','memory-backend','max-retries',
  'default-pipeline','output-format','data-output-path',
  'batch-size','parallel-workers','clock-format',
];

const TOGGLE_IDS = TOGGLES.map(([i]) => i);

/* ‚îÄ‚îÄ Dirty / unsaved state ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
let _dirty = false;

function markDirty() {
  if (_dirty) return;
  _dirty = true;
  const ind = document.getElementById('unsaved-indicator');
  if (ind) ind.style.display = 'inline';
}

function clearDirty() {
  _dirty = false;
  const ind = document.getElementById('unsaved-indicator');
  if (ind) ind.style.display = 'none';
}

/* Attach dirty listeners to all inputs after DOM ready */
function _attachDirtyListeners() {
  document.querySelectorAll('.sett-input, .sett-select').forEach(el => {
    el.addEventListener('input', markDirty);
    el.addEventListener('change', markDirty);
  });
  document.querySelectorAll('.sett-toggle input[type="checkbox"]').forEach(el => {
    el.addEventListener('change', markDirty);
  });
  const acEl = document.getElementById('accent-color');
  if (acEl) acEl.addEventListener('input', markDirty);
  const cfEl = document.getElementById('clock-format');
  if (cfEl) cfEl.addEventListener('change', markDirty);
}

/* ‚îÄ‚îÄ Collect current form state ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function _collectSettings() {
  const obj = {};
  FIELDS.forEach(id => {
    const el = document.getElementById(id);
    if (el) obj[id] = el.value;
  });
  TOGGLE_IDS.forEach(id => {
    const el = document.getElementById(id);
    if (el) obj[id] = el.checked;
  });
  obj['accent-color'] = document.getElementById('accent-color')?.value;
  return obj;
}

/* ‚îÄ‚îÄ Save ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function saveSettings(showMsg) {
  const obj = _collectSettings();
  /* localStorage is the primary store ‚Äî always write here first */
  try {
    localStorage.setItem(SETT_KEY, JSON.stringify(obj));
  } catch(e) {
    _flashMsg('‚úó STORAGE ERROR ‚Äî ' + e.message, true);
    return;
  }
  syncAllLabels();
  clearDirty();

  if (showMsg) _flashMsg('‚úì SETTINGS SAVED');
}

/* ‚îÄ‚îÄ Load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function loadSettings() {
  const raw = localStorage.getItem(SETT_KEY);
  if (!raw) { clearDirty(); return; }
  let obj;
  try { obj = JSON.parse(raw); } catch(_) { clearDirty(); return; }
  if (!obj || typeof obj !== 'object') { clearDirty(); return; }
  FIELDS.forEach(id => {
    const el = document.getElementById(id);
    if (el && obj[id] !== undefined) el.value = obj[id];
  });
  TOGGLE_IDS.forEach(id => {
    const el = document.getElementById(id);
    if (el && obj[id] !== undefined) el.checked = Boolean(obj[id]);
  });
  if (obj['accent-color']) {
    const ac = document.getElementById('accent-color');
    if (ac) { ac.value = obj['accent-color']; previewAccent(obj['accent-color']); }
  }
  syncAllLabels();
  clearDirty();
}

function resetAllSettings() {
  if (!confirm('Reset all settings to defaults?')) return;
  localStorage.removeItem(SETT_KEY);
  location.reload();
}

/* ‚îÄ‚îÄ Accent color preview ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function previewAccent(hex) {
  document.documentElement.style.setProperty('--orange', hex);
  const hexEl = document.getElementById('accent-hex');
  if (hexEl) hexEl.textContent = hex.toUpperCase();
}

function resetAccent() {
  const def = '#DA7756';
  document.getElementById('accent-color').value = def;
  previewAccent(def);
}

/* ‚îÄ‚îÄ Connection test ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
async function testConnection() {
  const dot   = document.getElementById('conn-dot');
  const label = document.getElementById('conn-label');
  if (dot) dot.style.background = '#f39c12';
  if (label) label.textContent = 'TESTING...';
  try {
    const r = await fetch('/api/metrics', { cache: 'no-store', signal: AbortSignal.timeout(5000) });
    if (r.ok) {
      if (dot)   dot.style.background   = '#2ecc71';
      if (label) label.textContent = 'ONLINE';
    } else {
      throw new Error('HTTP ' + r.status);
    }
  } catch(e) {
    if (dot)   dot.style.background   = '#e74c3c';
    if (label) label.textContent = 'OFFLINE';
  }
}

/* ‚îÄ‚îÄ Maintenance actions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function maintAction(action) {
  if (action === 'clear-log') {
    localStorage.removeItem('bcom-log');
    alert('Log cleared. Reload the dashboard to see changes.');
  } else if (action === 'clear-term') {
    localStorage.removeItem('bcom-terminal');
    alert('Terminal history cleared.');
  }
}

function confirmAction(label, endpoint) {
  if (!confirm('Are you sure you want to: ' + label + '?')) return;
  fetch(endpoint, { method: 'POST' }).catch(()=>{});
  alert(label + ' dispatched.');
}

/* ‚îÄ‚îÄ Export / Import ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function exportSettings() {
  saveSettings();
  const raw  = localStorage.getItem(SETT_KEY) || '{}';
  const blob = new Blob([JSON.stringify(JSON.parse(raw), null, 2)], { type: 'application/json' });
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href = url; a.download = 'bcom-settings.json'; a.click();
  URL.revokeObjectURL(url);
}

function importSettings(evt) {
  const file = evt.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const obj = JSON.parse(e.target.result);
      localStorage.setItem(SETT_KEY, JSON.stringify(obj));
      loadSettings();
      const msg = document.getElementById('save-msg');
      if (msg) { msg.textContent = '‚úì SETTINGS IMPORTED'; msg.classList.add('show'); setTimeout(() => { msg.classList.remove('show'); msg.textContent = '‚úì SETTINGS SAVED'; }, 2500); }
    } catch(_) { alert('Invalid settings file.'); }
  };
  reader.readAsText(file);
}

/* ‚îÄ‚îÄ triggerAction (from bcom.js) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function triggerAction(name) {
  alert('Dispatching: ' + name + '\n\nThis will POST to /api/action with { action: "' + name + '" }');
}

/* ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
syncThemeBtns();
loadSettings();
_attachDirtyListeners();
setTimeout(testConnection, 800);

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   THEME EDITOR
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

const THEME_VARS = [
  '--bg', '--bg-panel', '--bg-bar', '--bg-deep', '--input-bg',
  '--text', '--text-dim', '--text-muted',
  '--orange', '--orange-dark', '--orange-deep',
  '--border', '--border-dim',
];

const THEME_DEFAULTS = {
  '--bg':           '#3b3b3b',
  '--bg-panel':     '#3b3b3b',
  '--bg-bar':       '#3b3b3b',
  '--bg-deep':      '#3b3b3b',
  '--input-bg':     '#2e2e2e',
  '--text':         '#ffffff',
  '--text-dim':     '#e0e0e0',
  '--text-muted':   '#aaaaaa',
  '--orange':       '#DA7756',
  '--orange-dark':  '#b8613a',
  '--orange-deep':  '#6b3020',
  '--border':       '#b8613a',
  '--border-dim':   '#5a3a28',
};

function _apiBase() {
  const stored = localStorage.getItem('bcom-settings');
  try { const obj = JSON.parse(stored||'{}'); if (obj['api-base-url']) return obj['api-base-url'].replace(/\/$/,''); } catch(_) {}
  return '';
}

/* Read current live CSS variable values and populate pickers */
function themeReadCurrent() {
  const root = document.documentElement;
  THEME_VARS.forEach(v => {
    const el  = document.getElementById('tc-' + v);
    const hex = document.getElementById('th-' + v);
    if (!el) return;
    const cur = getComputedStyle(root).getPropertyValue(v).trim() || THEME_DEFAULTS[v] || '#888888';
    const hex6 = cssToHex(cur);
    el.value = hex6;
    if (hex) hex.textContent = hex6;
  });
}

/* Convert any CSS color string to #rrggbb for <input type=color> */
function cssToHex(str) {
  str = str.trim();
  if (/^#[0-9a-f]{6}$/i.test(str)) return str;
  if (/^#[0-9a-f]{3}$/i.test(str)) {
    const [,a,b,c] = str; return '#'+a+a+b+b+c+c;
  }
  const m = str.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
  if (m) return '#'+[m[1],m[2],m[3]].map(n=>parseInt(n).toString(16).padStart(2,'0')).join('');
  return '#888888';
}

/* Live preview ‚Äî update CSS var immediately */
function themePreview(varName, value) {
  document.documentElement.style.setProperty(varName, value);
  const hexEl = document.getElementById('th-' + varName);
  if (hexEl) hexEl.textContent = value.toUpperCase();
}

/* Collect current picker values into an object */
function themeCollect() {
  const vars = {};
  THEME_VARS.forEach(v => {
    const el = document.getElementById('tc-' + v);
    if (el) vars[v] = el.value;
  });
  return vars;
}

/* Apply: write collected vars to :root style */
function themeApply() {
  const vars = themeCollect();
  Object.entries(vars).forEach(([k,v]) => document.documentElement.style.setProperty(k, v));
  localStorage.setItem('bcom-theme-vars', JSON.stringify(vars));
  _flashMsg('‚úì THEME APPLIED');
}

/* Reset to defaults */
function themeReset() {
  Object.entries(THEME_DEFAULTS).forEach(([k,v]) => {
    document.documentElement.style.setProperty(k, v);
    const el = document.getElementById('tc-' + k);
    const hexEl = document.getElementById('th-' + k);
    if (el) el.value = v;
    if (hexEl) hexEl.textContent = v;
  });
  localStorage.removeItem('bcom-theme-vars');
  _flashMsg('‚úì THEME RESET');
}

/* Restore theme vars from localStorage on page load */
function themeRestoreLocal() {
  const raw = localStorage.getItem('bcom-theme-vars');
  if (!raw) return;
  try {
    const vars = JSON.parse(raw);
    Object.entries(vars).forEach(([k,v]) => document.documentElement.style.setProperty(k, v));
  } catch(_) {}
}

/* ‚îÄ‚îÄ Save prompt ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function themeSavePrompt() {
  const modal = document.getElementById('theme-name-modal');
  document.getElementById('theme-name-input').value = '';
  modal.classList.add('open');
  setTimeout(() => document.getElementById('theme-name-input').focus(), 80);
}
function themeSaveCancel() {
  document.getElementById('theme-name-modal').classList.remove('open');
}
async function themeSaveConfirm() {
  const name = document.getElementById('theme-name-input').value.trim();
  if (!name) { document.getElementById('theme-name-input').focus(); return; }
  themeSaveCancel();
  const vars = themeCollect();

  /* localStorage is the primary store for named themes */
  const themes = _getLocalThemes();
  /* Overwrite if name already exists, otherwise append */
  const existing = themes.findIndex(t => t.name.toLowerCase() === name.toLowerCase());
  const entry = { id: 'local-' + Date.now(), name, vars, savedAt: new Date().toISOString() };
  if (existing >= 0) { themes[existing] = { ...themes[existing], ...entry }; }
  else { themes.push(entry); }
  _setLocalThemes(themes);
  _flashMsg('‚úì THEME SAVED: ' + name.toUpperCase());
  themeLoadList();

  /* Fire-and-forget backend sync ‚Äî failure is silent */
  fetch(_apiBase() + '/api/themes', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, vars }),
  }).catch(() => {});
}

/* ‚îÄ‚îÄ Load themes list (localStorage primary, backend merge) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function themeLoadList() {
  const container = document.getElementById('saved-themes-list');
  const themes = _getLocalThemes();
  if (!themes.length) {
    container.innerHTML = '<span style="font-size:10px;color:var(--text-muted);letter-spacing:1px;">No saved themes yet.</span>';
    return;
  }
  container.innerHTML = themes.map(t => {
    const dots = ['--bg','--orange','--text','--border'].map(v => {
      const c = (t.vars||{})[v] || '#888';
      return `<div class="saved-theme-dot" style="background:${c};"></div>`;
    }).join('');
    return `<div class="saved-theme-row">
      <div class="saved-theme-dot-row">${dots}</div>
      <span class="saved-theme-name">${t.name}</span>
      <button class="saved-theme-btn" onclick="themeLoad(${JSON.stringify(JSON.stringify(t.vars))})">LOAD</button>
      <button class="saved-theme-btn del" onclick="themeDelete('${t.id}','${t.name.replace(/'/g,"\'")}')">‚úï</button>
    </div>`;
  }).join('');
}

/* Apply a saved theme from the list */
function themeLoad(varsJson) {
  const vars = JSON.parse(varsJson);
  Object.entries(vars).forEach(([k,v]) => {
    document.documentElement.style.setProperty(k, v);
    const el = document.getElementById('tc-' + k);
    const hexEl = document.getElementById('th-' + k);
    if (el) el.value = cssToHex(v);
    if (hexEl) hexEl.textContent = v.toUpperCase();
  });
  localStorage.setItem('bcom-theme-vars', JSON.stringify(vars));
  _flashMsg('‚úì THEME LOADED');
}

/* Delete a saved theme */
async function themeDelete(id, name) {
  if (!confirm('Delete theme "' + name + '"?')) return;

  /* Remove from localStorage first (primary) */
  _setLocalThemes(_getLocalThemes().filter(t => t.id !== id));
  _flashMsg('‚úì THEME DELETED');
  themeLoadList();

  /* Fire-and-forget backend delete for non-local IDs */
  if (!String(id).startsWith('local-')) {
    fetch(_apiBase() + '/api/themes/' + id, { method: 'DELETE' }).catch(() => {});
  }
}

function _flashMsg(msg, err) {
  const el = document.getElementById('save-msg');
  if (!el) return;
  el.textContent = msg;
  el.style.color = err ? '#e74c3c' : '';
  el.classList.add('show');
  setTimeout(() => { el.classList.remove('show'); el.textContent = '‚úì SETTINGS SAVED'; el.style.color=''; }, 2800);
}

/* ‚îÄ‚îÄ Init theme editor ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
themeRestoreLocal();
themeReadCurrent();
themeLoadList();

</script>
</body>
</html>
