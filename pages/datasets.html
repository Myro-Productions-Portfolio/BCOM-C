<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BCOM-C — Datasets</title>
<script>
  (function(){
    var t=localStorage.getItem("bcom-theme")||"dark";
    document.documentElement.setAttribute("data-theme",t);
    try { var raw=localStorage.getItem("bcom-theme-vars"); if(raw){ var vars=JSON.parse(raw); Object.keys(vars).forEach(function(k){ document.documentElement.style.setProperty(k,vars[k]); }); } } catch(_) {}
  })();
</script>
<link rel="stylesheet" href="../assets/css/bcom.css?v=3" />
<style>
  /* ── Hero chips ───────────────────────────────────────── */
  .ds-hero {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 16px;
  }
  .ds-chip {
    background: #0a0704;
    border: 1px solid #1a0e06;
    padding: 12px 18px;
    display: flex;
    flex-direction: column;
    gap: 3px;
    min-width: 130px;
  }
  .ds-chip-label {
    font-size: 9px;
    letter-spacing: 1.8px;
    color: #555;
    text-transform: uppercase;
  }
  .ds-chip-val {
    font-size: 22px;
    color: var(--orange-dark);
    font-variant-numeric: tabular-nums;
    line-height: 1;
  }

  /* ── Filter bar ───────────────────────────────────────── */
  .ds-filterbar {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }
  .ds-search {
    flex: 1 1 220px;
    background: #0a0704;
    border: 1px solid #1a0e06;
    color: var(--text-primary);
    padding: 7px 10px;
    font-size: 12px;
    font-family: inherit;
    outline: none;
  }
  .ds-search:focus { border-color: var(--orange-dark); }
  .ds-search::placeholder { color: #444; }

  .ds-filter-sel {
    background: #0a0704;
    border: 1px solid #1a0e06;
    color: var(--text-primary);
    padding: 7px 10px;
    font-size: 12px;
    font-family: inherit;
    outline: none;
    cursor: pointer;
  }
  .ds-filter-sel:focus { border-color: var(--orange-dark); }

  /* ── Datasets table ───────────────────────────────────── */
  .ds-table-wrap {
    overflow-x: auto;
  }
  .ds-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
  }
  .ds-table th {
    text-align: left;
    padding: 8px 10px;
    font-size: 9px;
    letter-spacing: 1.5px;
    color: #555;
    border-bottom: 1px solid #1a0e06;
    white-space: nowrap;
    cursor: pointer;
    user-select: none;
  }
  .ds-table th:hover { color: var(--orange-dark); }
  .ds-table th .sort-arrow { margin-left: 4px; opacity: 0.4; }
  .ds-table th.sort-active { color: var(--orange-dark); }
  .ds-table th.sort-active .sort-arrow { opacity: 1; }
  .ds-table td {
    padding: 9px 10px;
    border-bottom: 1px solid #120b04;
    color: var(--text-primary);
    vertical-align: middle;
    white-space: nowrap;
  }
  .ds-table tr:hover td { background: #0e0804; cursor: pointer; }
  .ds-table .ds-id {
    color: #444;
    font-size: 10px;
    max-width: 120px;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .ds-table .ds-name {
    color: var(--text-primary);
    font-weight: 500;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .ds-table .ds-tag {
    display: inline-block;
    font-size: 9px;
    letter-spacing: 1px;
    padding: 2px 6px;
    border: 1px solid #1a0e06;
    color: #888;
    margin-right: 3px;
  }
  .ds-empty {
    text-align: center;
    color: #444;
    padding: 32px;
    font-size: 12px;
    letter-spacing: 1px;
  }

  /* ── Detail panel (slide-out) ─────────────────────────── */
  .ds-detail-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    z-index: 200;
  }
  .ds-detail-overlay.open { display: block; }
  .ds-detail-panel {
    position: fixed;
    top: 0; right: 0; bottom: 0;
    width: min(620px, 100vw);
    background: #0a0704;
    border-left: 1px solid #1a0e06;
    z-index: 201;
    display: flex;
    flex-direction: column;
    transform: translateX(100%);
    transition: transform 0.22s ease;
    overflow: hidden;
  }
  .ds-detail-overlay.open .ds-detail-panel {
    transform: translateX(0);
  }
  .ds-detail-hdr {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 18px;
    border-bottom: 1px solid #1a0e06;
    flex-shrink: 0;
  }
  .ds-detail-title {
    font-size: 11px;
    letter-spacing: 2px;
    color: var(--orange-dark);
    font-weight: 600;
  }
  .ds-detail-close {
    background: none;
    border: 1px solid #1a0e06;
    color: #888;
    padding: 4px 10px;
    cursor: pointer;
    font-size: 11px;
    letter-spacing: 1px;
    font-family: inherit;
  }
  .ds-detail-close:hover { border-color: var(--orange-dark); color: var(--orange-dark); }
  .ds-detail-body {
    flex: 1;
    overflow-y: auto;
    padding: 18px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* Detail sections */
  .ds-sec-label {
    font-size: 9px;
    letter-spacing: 2px;
    color: #555;
    margin-bottom: 8px;
    padding-bottom: 4px;
    border-bottom: 1px solid #150d05;
  }
  .ds-kv-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px 16px;
  }
  .ds-kv { display: flex; flex-direction: column; gap: 2px; }
  .ds-kv-key {
    font-size: 9px;
    letter-spacing: 1.5px;
    color: #444;
  }
  .ds-kv-val {
    font-size: 13px;
    color: var(--text-primary);
    font-variant-numeric: tabular-nums;
  }

  /* Examples preview */
  .ds-example-card {
    background: #080604;
    border: 1px solid #150d05;
    padding: 10px 12px;
    margin-bottom: 8px;
    font-size: 11px;
    line-height: 1.55;
  }
  .ds-ex-label {
    font-size: 9px;
    letter-spacing: 1.5px;
    color: var(--orange-dark);
    margin-bottom: 5px;
  }
  .ds-ex-text {
    color: #aaa;
    white-space: pre-wrap;
    word-break: break-word;
    max-height: 120px;
    overflow-y: auto;
  }

  /* Provenance chain */
  .prov-chain {
    display: flex;
    flex-direction: column;
    gap: 0;
  }
  .prov-step {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    position: relative;
  }
  .prov-step:not(:last-child)::before {
    content: '';
    position: absolute;
    left: 11px;
    top: 24px;
    bottom: -4px;
    width: 1px;
    background: #1a0e06;
  }
  .prov-dot {
    width: 22px;
    height: 22px;
    border: 1px solid var(--orange-dark);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 9px;
    color: var(--orange-dark);
    flex-shrink: 0;
    margin-top: 2px;
    background: #080604;
  }
  .prov-info {
    padding-bottom: 16px;
    flex: 1;
  }
  .prov-op {
    font-size: 11px;
    color: var(--text-primary);
    font-weight: 500;
    letter-spacing: 0.5px;
  }
  .prov-meta {
    font-size: 10px;
    color: #555;
    margin-top: 2px;
  }
  .prov-src {
    font-size: 10px;
    color: #888;
    margin-top: 3px;
    font-style: italic;
  }

  .ds-detail-spinner {
    text-align: center;
    color: #444;
    padding: 40px;
    font-size: 11px;
    letter-spacing: 1.5px;
  }
  .ds-detail-err {
    color: #e74c3c;
    font-size: 11px;
    letter-spacing: 1px;
    padding: 12px;
    border: 1px solid #3a1010;
    background: #1a0808;
  }
</style>
</head>
<body>

<!-- ── Nav ─────────────────────────────────────────────── -->
<nav class="bcom-nav">
  <a href="../index.html" class="bcom-nav-logo">BCOM-C</a>
  <div class="bcom-nav-links">
    <a href="registry.html">REGISTRY</a>
    <a href="data-gen.html">DATAGEN</a>
    <a href="coordinator.html">COORDINATOR</a>
    <a href="datasets.html" class="active">DATASETS</a>
    <a href="finetune.html">FINETUNE</a>
    <a href="monitor.html">MONITOR</a>
  </div>
</nav>

<!-- ── Main ────────────────────────────────────────────── -->
<main class="bcom-main">

  <!-- Hero -->
  <div class="ds-hero">
    <div class="ds-chip">
      <span class="ds-chip-label">TOTAL DATASETS</span>
      <span class="ds-chip-val" id="chip-total">—</span>
    </div>
    <div class="ds-chip">
      <span class="ds-chip-label">TOTAL EXAMPLES</span>
      <span class="ds-chip-val" id="chip-examples">—</span>
    </div>
    <div class="ds-chip">
      <span class="ds-chip-label">EST. TOKENS</span>
      <span class="ds-chip-val" id="chip-tokens">—</span>
    </div>
    <div class="ds-chip">
      <span class="ds-chip-label">DATA SOURCES</span>
      <span class="ds-chip-val" id="chip-sources">—</span>
    </div>
  </div>

  <!-- Filter bar -->
  <div class="ds-filterbar">
    <input class="ds-search" id="ds-search" type="text" placeholder="SEARCH DATASETS..." autocomplete="off" />
    <select class="ds-filter-sel" id="ds-filter-tag">
      <option value="">ALL TAGS</option>
    </select>
    <select class="ds-filter-sel" id="ds-filter-source">
      <option value="">ALL SOURCES</option>
    </select>
  </div>

  <!-- Table -->
  <div class="section-panel">
    <div class="section-hdr">
      <span class="section-title">DATASETS</span>
      <span class="section-meta" id="ds-count-label">LOADING…</span>
    </div>
    <div class="ds-table-wrap">
      <table class="ds-table" id="ds-table">
        <thead>
          <tr>
            <th data-col="name">NAME <span class="sort-arrow">↕</span></th>
            <th data-col="example_count">EXAMPLES <span class="sort-arrow">↕</span></th>
            <th data-col="token_count">TOKENS <span class="sort-arrow">↕</span></th>
            <th data-col="source">SOURCE <span class="sort-arrow">↕</span></th>
            <th>TAGS</th>
            <th data-col="created_at">CREATED <span class="sort-arrow">↕</span></th>
            <th></th>
          </tr>
        </thead>
        <tbody id="ds-tbody">
          <tr><td colspan="7" class="ds-empty">LOADING…</td></tr>
        </tbody>
      </table>
    </div>
  </div>

</main>

<!-- ── Detail overlay ──────────────────────────────────── -->
<div class="ds-detail-overlay" id="ds-overlay">
  <div class="ds-detail-panel" id="ds-panel">
    <div class="ds-detail-hdr">
      <span class="ds-detail-title" id="panel-title">DATASET DETAIL</span>
      <button class="ds-detail-close" id="panel-close">✕ CLOSE</button>
    </div>
    <div class="ds-detail-body" id="panel-body">
      <div class="ds-detail-spinner">LOADING…</div>
    </div>
  </div>
</div>

<script src="../assets/js/bcom.js?v=5"></script>
<script>
(function(){
  'use strict';

  /* ── State ──────────────────────────────────────────── */
  var _datasets   = [];
  var _filtered   = [];
  var _sortCol    = 'created_at';
  var _sortDir    = -1; // -1 = desc
  var _pollTimer  = null;

  /* ── Helpers ────────────────────────────────────────── */
  function fmt(n) {
    if (n == null) return '—';
    return Number(n).toLocaleString();
  }
  function fmtK(n) {
    if (n == null) return '—';
    if (n >= 1e6) return (n/1e6).toFixed(1) + 'M';
    if (n >= 1e3) return (n/1e3).toFixed(1) + 'K';
    return String(n);
  }
  function fmtDate(s) {
    if (!s) return '—';
    try {
      var d = new Date(s);
      return d.toLocaleDateString('en-US', { month:'short', day:'numeric', year:'numeric' });
    } catch(_) { return s; }
  }
  function escHtml(s) {
    return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  /* ── Hero chips ─────────────────────────────────────── */
  function updateHero() {
    var total    = _datasets.length;
    var examples = _datasets.reduce(function(a,d){ return a + (d.example_count||0); }, 0);
    var tokens   = _datasets.reduce(function(a,d){ return a + (d.token_count||0); }, 0);
    document.getElementById('chip-total').textContent    = fmt(total);
    document.getElementById('chip-examples').textContent = fmtK(examples);
    document.getElementById('chip-tokens').textContent   = fmtK(tokens);
  }

  /* ── Source chip (from /api/data/sources) ───────────── */
  function loadSources() {
    fetch('/api/data/sources', { cache:'no-store' }).then(function(r){
      if (!r.ok) return;
      return r.json();
    }).then(function(data){
      if (!data) return;
      var sources = Array.isArray(data) ? data : (data.sources || []);
      document.getElementById('chip-sources').textContent = fmt(sources.length);
      var sel = document.getElementById('ds-filter-source');
      sources.forEach(function(s){
        var id = typeof s === 'string' ? s : (s.id || s.name || String(s));
        var label = typeof s === 'string' ? s : (s.name || s.id || String(s));
        var opt = document.createElement('option');
        opt.value = id; opt.textContent = label.toUpperCase();
        sel.appendChild(opt);
      });
    }).catch(function(){});
  }

  /* ── Filter helpers ─────────────────────────────────── */
  function buildTagFilter() {
    var tags = {};
    _datasets.forEach(function(d){
      if (Array.isArray(d.tags)) d.tags.forEach(function(t){ tags[t] = true; });
    });
    var sel = document.getElementById('ds-filter-tag');
    // Clear existing (keep first "ALL TAGS")
    while (sel.options.length > 1) sel.remove(1);
    Object.keys(tags).sort().forEach(function(t){
      var opt = document.createElement('option');
      opt.value = t; opt.textContent = t.toUpperCase();
      sel.appendChild(opt);
    });
  }

  function applyFilters() {
    var q   = document.getElementById('ds-search').value.trim().toLowerCase();
    var tag = document.getElementById('ds-filter-tag').value;
    var src = document.getElementById('ds-filter-source').value;

    _filtered = _datasets.filter(function(d){
      if (q) {
        var hay = ((d.name||'') + ' ' + (d.id||'') + ' ' + (d.description||'')).toLowerCase();
        if (hay.indexOf(q) === -1) return false;
      }
      if (tag && !(Array.isArray(d.tags) && d.tags.indexOf(tag) !== -1)) return false;
      if (src && d.source !== src) return false;
      return true;
    });

    // Sort
    _filtered.sort(function(a, b){
      var av = a[_sortCol], bv = b[_sortCol];
      if (av == null) av = '';
      if (bv == null) bv = '';
      if (typeof av === 'string') av = av.toLowerCase();
      if (typeof bv === 'string') bv = bv.toLowerCase();
      if (av < bv) return -1 * _sortDir;
      if (av > bv) return 1  * _sortDir;
      return 0;
    });

    renderTable();
  }

  /* ── Sort headers ───────────────────────────────────── */
  document.querySelectorAll('.ds-table th[data-col]').forEach(function(th){
    th.addEventListener('click', function(){
      var col = th.getAttribute('data-col');
      if (_sortCol === col) { _sortDir *= -1; }
      else { _sortCol = col; _sortDir = -1; }
      document.querySelectorAll('.ds-table th').forEach(function(h){ h.classList.remove('sort-active'); });
      th.classList.add('sort-active');
      th.querySelector('.sort-arrow').textContent = _sortDir === -1 ? '↓' : '↑';
      applyFilters();
    });
  });

  /* ── Table render ───────────────────────────────────── */
  function renderTable() {
    var tbody = document.getElementById('ds-tbody');
    document.getElementById('ds-count-label').textContent =
      _filtered.length + ' / ' + _datasets.length + ' DATASETS';

    if (_filtered.length === 0) {
      tbody.innerHTML = '<tr><td colspan="7" class="ds-empty">NO DATASETS MATCH FILTER</td></tr>';
      return;
    }

    var html = '';
    _filtered.forEach(function(d){
      var tags = Array.isArray(d.tags) ? d.tags : [];
      var tagHtml = tags.slice(0,4).map(function(t){
        return '<span class="ds-tag">' + escHtml(t) + '</span>';
      }).join('');

      html += '<tr data-id="' + escHtml(d.id) + '">' +
        '<td><div class="ds-name" title="' + escHtml(d.name||d.id) + '">' + escHtml(d.name||d.id) + '</div>' +
             '<div class="ds-id">' + escHtml(d.id) + '</div></td>' +
        '<td>' + fmt(d.example_count) + '</td>' +
        '<td>' + fmtK(d.token_count) + '</td>' +
        '<td>' + escHtml(d.source||'—') + '</td>' +
        '<td>' + (tagHtml || '<span style="color:#333">—</span>') + '</td>' +
        '<td>' + fmtDate(d.created_at) + '</td>' +
        '<td><button class="bcom-btn bcom-btn-sm ds-view-btn" data-id="' + escHtml(d.id) + '">VIEW</button></td>' +
      '</tr>';
    });
    tbody.innerHTML = html;

    // Row + button click → open detail
    tbody.querySelectorAll('tr[data-id]').forEach(function(tr){
      tr.addEventListener('click', function(e){
        if (e.target.classList.contains('ds-view-btn')) return; // handled below
        openDetail(tr.getAttribute('data-id'));
      });
    });
    tbody.querySelectorAll('.ds-view-btn').forEach(function(btn){
      btn.addEventListener('click', function(e){
        e.stopPropagation();
        openDetail(btn.getAttribute('data-id'));
      });
    });
  }

  /* ── Load datasets list ─────────────────────────────── */
  function loadDatasets() {
    fetch('/api/data/datasets', { cache:'no-store' }).then(function(r){
      if (!r.ok) throw new Error('HTTP ' + r.status);
      return r.json();
    }).then(function(data){
      _datasets = Array.isArray(data) ? data : (data.datasets || data.items || []);
      updateHero();
      buildTagFilter();
      applyFilters();
    }).catch(function(err){
      document.getElementById('ds-tbody').innerHTML =
        '<tr><td colspan="7" class="ds-empty" style="color:#e74c3c">ERROR: ' + escHtml(String(err)) + '</td></tr>';
      document.getElementById('ds-count-label').textContent = 'ERROR';
    });
  }

  /* ── Detail panel ───────────────────────────────────── */
  var _overlay = document.getElementById('ds-overlay');
  var _panel   = document.getElementById('panel-body');

  document.getElementById('panel-close').addEventListener('click', closeDetail);
  _overlay.addEventListener('click', function(e){
    if (e.target === _overlay) closeDetail();
  });

  function closeDetail() {
    _overlay.classList.remove('open');
  }

  function openDetail(id) {
    // Find dataset record
    var ds = null;
    for (var i = 0; i < _datasets.length; i++) {
      if (_datasets[i].id === id) { ds = _datasets[i]; break; }
    }
    document.getElementById('panel-title').textContent = ds ? (ds.name || id).toUpperCase() : id.toUpperCase();
    _panel.innerHTML = '<div class="ds-detail-spinner">LOADING…</div>';
    _overlay.classList.add('open');

    // Fetch stats, examples, provenance in parallel
    Promise.all([
      fetch('/api/data/datasets/' + encodeURIComponent(id) + '/stats',      { cache:'no-store' }).then(function(r){ return r.ok ? r.json() : null; }).catch(function(){ return null; }),
      fetch('/api/data/datasets/' + encodeURIComponent(id) + '/examples',   { cache:'no-store' }).then(function(r){ return r.ok ? r.json() : null; }).catch(function(){ return null; }),
      fetch('/api/data/datasets/' + encodeURIComponent(id) + '/provenance', { cache:'no-store' }).then(function(r){ return r.ok ? r.json() : null; }).catch(function(){ return null; })
    ]).then(function(results){
      var stats  = results[0];
      var exData = results[1];
      var prov   = results[2];
      renderDetail(ds, stats, exData, prov);
    });
  }

  function renderDetail(ds, stats, exData, prov) {
    var html = '';

    /* — Meta section — */
    html += '<div><div class="ds-sec-label">DATASET INFO</div>';
    html += '<div class="ds-kv-grid">';
    if (ds) {
      html += kv('ID', ds.id);
      html += kv('NAME', ds.name || '—');
      html += kv('SOURCE', ds.source || '—');
      html += kv('CREATED', fmtDate(ds.created_at));
      html += kv('EXAMPLES', fmt(ds.example_count));
      html += kv('TOKENS', fmtK(ds.token_count));
    }
    html += '</div></div>';

    /* — Stats section — */
    if (stats) {
      html += '<div><div class="ds-sec-label">STATS</div>';
      html += '<div class="ds-kv-grid">';
      var keys = Object.keys(stats);
      keys.forEach(function(k){
        if (k === 'id' || k === 'dataset_id') return;
        var v = stats[k];
        if (typeof v === 'object') v = JSON.stringify(v);
        html += kv(k.toUpperCase().replace(/_/g,' '), typeof v === 'number' ? fmt(v) : escHtml(String(v||'—')));
      });
      html += '</div></div>';
    }

    /* — Examples section — */
    var examples = [];
    if (exData) {
      examples = Array.isArray(exData) ? exData : (exData.examples || exData.items || []);
    }
    if (examples.length > 0) {
      html += '<div><div class="ds-sec-label">EXAMPLES (PREVIEW)</div>';
      examples.slice(0, 5).forEach(function(ex, i){
        html += '<div class="ds-example-card">';
        html += '<div class="ds-ex-label">EXAMPLE ' + (i+1) + '</div>';
        var text = typeof ex === 'string' ? ex :
                   (ex.text || ex.content || ex.input || ex.prompt || ex.output || JSON.stringify(ex));
        html += '<div class="ds-ex-text">' + escHtml(String(text).slice(0, 600)) + (String(text).length > 600 ? '…' : '') + '</div>';
        html += '</div>';
      });
      if (examples.length > 5) {
        html += '<div style="font-size:10px;color:#444;letter-spacing:1px;padding:4px 0">+ ' + (examples.length - 5) + ' MORE EXAMPLES</div>';
      }
      html += '</div>';
    }

    /* — Provenance chain — */
    var chain = [];
    if (prov) {
      chain = Array.isArray(prov) ? prov : (prov.steps || prov.chain || prov.provenance || []);
    }
    if (chain.length > 0) {
      html += '<div><div class="ds-sec-label">PROVENANCE CHAIN</div>';
      html += '<div class="prov-chain">';
      chain.forEach(function(step, i){
        var op  = step.operation || step.op || step.type || step.action || 'STEP';
        var src = step.source || step.input || step.from || '';
        var ts  = step.timestamp || step.created_at || step.date || '';
        var meta = [];
        if (step.model)   meta.push('model: ' + step.model);
        if (step.version) meta.push('v' + step.version);
        if (step.count)   meta.push(fmt(step.count) + ' items');
        if (ts) meta.push(fmtDate(ts));

        html += '<div class="prov-step">';
        html += '<div class="prov-dot">' + (i+1) + '</div>';
        html += '<div class="prov-info">';
        html += '<div class="prov-op">' + escHtml(String(op).toUpperCase()) + '</div>';
        if (meta.length) html += '<div class="prov-meta">' + escHtml(meta.join('  ·  ')) + '</div>';
        if (src) html += '<div class="prov-src">' + escHtml(String(src)) + '</div>';
        html += '</div></div>';
      });
      html += '</div></div>';
    } else if (prov !== null && prov !== undefined) {
      html += '<div><div class="ds-sec-label">PROVENANCE</div>';
      html += '<div style="font-size:11px;color:#444;letter-spacing:1px">NO PROVENANCE DATA</div></div>';
    }

    _panel.innerHTML = html;
  }

  function kv(label, val) {
    return '<div class="ds-kv"><span class="ds-kv-key">' + label + '</span><span class="ds-kv-val">' + escHtml(String(val||'—')) + '</span></div>';
  }

  /* ── Filter events ──────────────────────────────────── */
  document.getElementById('ds-search').addEventListener('input', applyFilters);
  document.getElementById('ds-filter-tag').addEventListener('change', applyFilters);
  document.getElementById('ds-filter-source').addEventListener('change', applyFilters);

  /* ── Init ───────────────────────────────────────────── */
  loadDatasets();
  loadSources();
  _pollTimer = setInterval(loadDatasets, 30000);

  window.addEventListener('beforeunload', function(){
    if (_pollTimer) clearInterval(_pollTimer);
  });

})();
</script>
</body>
</html>
